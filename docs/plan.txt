================================================================================
  AVASIM - DEVELOPMENT PLAN & NEXT STEPS
  Last updated: 2025-02-10
================================================================================

What is Built (current state)
-----------------------------
[x] Core combat engine (~1,800 lines) - full attack resolution, contested
    evasion, graze, armor soak, critical hits, death saves, spell saves,
    AOE spells, overcast consequences
[x] 21 weapon classes with Avalore-accurate stats, requirements, and traits
    (audited against rules doc - all correct)
[x] 3 armor types + 2 shield types with soak / block mechanics
    (fixed: medium armor 1d4-1, heavy armor 1d4 per rules)
[x] 52 feats defined in data; ALL have engine implementations
[x] Full spellcasting system - 20 spells across 6 disciplines (Force,
    Ichor, Cursesmithy, Ether, Artifice, Tellurgy)
[x] 10x10 tactical map with terrain, pathfinding, dash, vault
[x] PySide6 desktop GUI with combatant editor, equipment/feat picker,
    3 sim modes, scenario presets, save/load, day/night toggle
[x] TacticalMapWidget (QGraphicsView) with overlays, legend, click/hover,
    scroll-wheel zoom, selection highlights, attack flash animation,
    theme-aware tile colors, rich occupant tooltips
[x] Action replay slider with per-action snapshots
[x] Decision-math drawer (AI transparency toggle)
[x] Initiative display + turn tracker
[x] HP/Armor/Anima progress bars, status badges panel with full chips
    (Bastion, Flowing Stance, Inspired, Critical/skull, death saves,
    weapon/armor labels, all StatusEffect enums)
[x] Log collapsing + colorized action log
[x] Export: HTML + CSV log export
[x] Scenario editor dialog (place units/terrain, save/load JSON)
[x] Standalone CombatAI module with 4 strategies (aggressive, defensive,
    balanced, random) and EV-based decision making
[x] Multi-combatant support (up to 8 combatants, team assignment)
[x] Batch simulation with matplotlib charts + loadout comparison
[x] Feat picker with checkboxes, description tooltips, and requirement
    display in CombatantEditor
[x] Equipment stat-requirement warnings (real-time validation)
[x] Block disabled when no shield equipped (input guardrail)
[x] Expanded Quick Start dialog explaining all simulation modes
[x] Dark/Light theme system (ui/theme.py, ThemeManager, QSS generation)
[x] Unit tests for combat, AI, and tactical map


================================================================================
  COMPLETED PHASES
================================================================================

  Phase 1 - Rules Fidelity and Engine Completeness     [COMPLETED]
  Phase 2 - AI and Simulation Depth                    [COMPLETED]
  Phase 3 - UI Polish and User Experience              [COMPLETED]


================================================================================
  PHASE 4 - VISUAL OVERHAUL (UI UPGRADE)               â˜… NEXT UP â˜…
================================================================================

  Goal: Transform AvaSim from "functional Python app" into something that
  looks and feels like a polished indie tool. Every surface the user sees
  should feel intentional, spatial, and satisfying to interact with.

  -----------------------------------------------------------------------
  4.1  Layout Architecture â€” Sidebar + Main Canvas
  -----------------------------------------------------------------------
  Status: Current layout is a flat QVBoxLayout â†’ QTabWidget with two tabs
  (Character, Simulation).  Everything feels stacked and cramped.

  Tasks:
  - Replace the tab-based layout with a persistent sidebar + main content
    area (QSplitter or custom layout)
  - Sidebar sections: Characters, Scenario, Simulation Controls, Batch
  - Main canvas area shows the tactical map prominently (occupies 60%+
    of the window), with the action log in a collapsible bottom drawer
  - Move the replay slider and transport controls (play/pause/step) into
    a bottom toolbar bar that pins below the map
  - Target minimum window: 1280Ã—800; look good at 1920Ã—1080
  - Add a header/title bar area with the AvaSim logo, version, and the
    theme toggle as an icon button (sun/moon)

  -----------------------------------------------------------------------
  4.2  Character Cards â€” Visual Redesign
  -----------------------------------------------------------------------
  Status: CombatantEditor is a tall vertical stack of QGroupBoxes with
  raw QSpinBoxes. Status badges are inline HTML in a QTextEdit.

  Tasks:
  - Redesign CombatantEditor as a compact card with a dark header strip
    showing name + team color dot
  - Replace the grid of spin boxes for stats with a horizontal row of
    circular "stat pips" or compact labeled badges (e.g., STR +2 | DEX +1)
  - Equipment section: show weapon/armor as icon + label tiles instead of
    raw combo boxes (keep the combo as the picker, but preview the result
    as a styled tile)
  - Feat section: show selected feats as small rounded chips/tags below
    the equipment area rather than a scrollable checkbox list
  - In-combat status card: render each combatant as a floating card
    overlay on or beside the map showing HP bar, Anima bar, status
    chips, equipped weapon icon, and a portrait placeholder
  - Add subtle CSS drop shadows, rounded corners (12px), and consistent
    spacing (8/12/16px rhythm) to all cards

  -----------------------------------------------------------------------
  4.3  Map Visual Upgrade
  -----------------------------------------------------------------------
  Status: TacticalMapWidget draws flat solid-color rectangles with 1px
  gray borders. Terrain is distinguished only by fill color.

  Tasks:
  - Increase default cell size to 48Ã—48 for more room
  - Draw terrain with hatching/patterns instead of just fill color:
      * Forest: green fill + subtle tree cross-hatch or small triangle
      * Water: blue fill + horizontal wave lines
      * Mountain: brown fill + small peak chevrons
      * Wall: dark fill + brick-pattern cross-hatch
      * Road: tan fill + center dashed line
  - Draw unit tokens as colored circles (team-colored border, white fill,
    bold 2-letter initials centered) instead of raw addText
  - Active unit: animated pulsing border or glow ring
  - Dead units: ghosted / semi-transparent token with X overlay
  - Draw grid lines as thin dotted lines (#ccc) instead of solid
  - Add subtle coordinate labels (A-J columns, 1-10 rows) on edges
  - Support a "fog of war" dimming for tiles outside LOS
  - On attack: brief particle-like scatter or radial flash (use
    QGraphicsEllipseItem with opacity animation via QPropertyAnimation)

  -----------------------------------------------------------------------
  4.4  Action Log & Combat Feed Overhaul
  -----------------------------------------------------------------------
  Status: Combat log is a monospace QTextEdit with raw text lines.
  TextHighlighter colorizes by keyword but output still looks like a
  terminal dump.

  Tasks:
  - Replace the raw log with a styled "combat feed" widget:
      * Each event is a card/row with an icon (âš” attack, ðŸ›¡ block,
        ðŸ’¨ move, ðŸ’€ death, âœ¨ feat) and colored left-border accent
      * Dice results shown as inline mini-badges: [2d10: 7+4 = 11]
      * Damage numbers in bold red, healing in bold green
      * Round headers as full-width section dividers
  - Add a mini-filter toolbar above the log: toggle visibility of
    move events, dice details, AI reasoning
  - Auto-scroll to newest event; dim older events slightly
  - Keep the existing export (HTML/CSV) working with the new format

  -----------------------------------------------------------------------
  4.5  Replay & Timeline Bar
  -----------------------------------------------------------------------
  Status: Replay is a QSlider + three QPushButtons (Step Back, Play,
  Step Forward).  No visual indication of what happened at each step.

  Tasks:
  - Replace the plain slider with a visual timeline strip:
      * Small dots/pips for each snapshot, colored by event type
        (red = damage, blue = move, green = heal/buff, gray = stance)
      * Hover a pip to see a tooltip summary ("Round 2: Captain attacks
        Brigand for 6 damage")
  - Add a scrubbing thumbnail: as the user drags the slider, the map
    live-updates (already works) but also show a 1-line caption below
    the timeline describing the current action
  - Playback speed selector (0.5Ã—, 1Ã—, 2Ã—)

  -----------------------------------------------------------------------
  4.6  Typography and Iconography
  -----------------------------------------------------------------------
  Status: Fonts default to "Segoe UI" / "Courier New" via FontConfig.
  Icons come from Font Awesome 4 via qtawesome. Many buttons have no
  icon or use a generic one.

  Tasks:
  - Switch to a modern variable-weight font: Inter for UI text,
    JetBrains Mono for log/code displays (bundle .ttf in assets/)
  - Audit every button, menu item, and label for appropriate icons;
    upgrade from FA4 to FA6 (qtawesome supports "fa6s.*" prefix)
  - Add custom SVG weapon/armor icons (16Ã—16) for the equipment
    section: sword, shield, bow, staff, armor silhouettes
  - Use emoji or FA6 icons consistently for status chips instead of
    the current 3-letter codes (PRN, SLO, DIS â†’ proper icons)
  - Heading hierarchy: section titles 14pt bold accent color,
    subsection 12pt semibold, body 11pt regular, caption 9pt dimmed

  -----------------------------------------------------------------------
  4.7  Theme System Upgrade
  -----------------------------------------------------------------------
  Status: ThemeManager generates one large QSS string. Two palettes
  (DARK / LIGHT) exist with good color choices but the app looks
  mostly the same in both modes because the map, status badges, and
  progress bars use hard-coded colors.

  Tasks:
  - Audit every hard-coded QColor/hex in pyside_app.py and map_widget.py;
    replace with palette lookups from ThemeManager
  - Status badge HTML in _format_status_badges: use palette-derived
    chip colors instead of hard-coded hex strings
  - Progress bars (HP, Armor, Anima): use palette accent colors so they
    shift with theme
  - Toast notifications: theme-aware background
  - Add a "High Contrast" theme variant for accessibility
  - Persist theme choice in settings.json (partially done â€” wire the
    load path so it restores on launch)

  -----------------------------------------------------------------------
  4.8  Micro-interactions and Animations
  -----------------------------------------------------------------------
  Status: AnimatedButton exists but is a stub (hover cursor change only).
  StatusBadge has a pulse method but it's unused. No transitions exist.

  Tasks:
  - Button hover: subtle background-color transition (150ms ease)
    using QPropertyAnimation or style-sheet transition
  - Tab/panel switch: brief fade-in on the new content
    (QGraphicsOpacityEffect)
  - Status badge appear/disappear: scale-in from 0.8â†’1.0 (200ms)
  - Simulation start: progress indicator smoothly fills while combat
    runs; spinner icon on the Run button while processing
  - Map zoom: smooth animated scale transition instead of instant jump
  - Toast notifications: slide-in from top, auto-fade after 3s
  - Turn transition: brief "Round N" banner overlay that fades out

  -----------------------------------------------------------------------
  4.9  Responsive and Resizable Layout
  -----------------------------------------------------------------------
  Status: Window has setMinimumSize(1000, 700) but content doesn't
  gracefully reflow at larger sizes â€” the map stays tiny and text
  areas consume excess space.

  Tasks:
  - Use QSplitter for map vs. sidebar so user can drag to resize
  - Map should expand to fill available space (remove setFixedHeight)
  - Character cards: 2-column grid at wide widths, single column at
    narrow widths (or use a QFlowLayout equivalent)
  - Log panel: collapsible with a drag handle or toggle button
  - Test at 1280Ã—800, 1920Ã—1080, and 2560Ã—1440; ensure nothing clips


================================================================================
  PHASE 5 - Scenario and Content                       (AFTER UI UPGRADE)
================================================================================

5.1  Curated preset scenarios
     Tasks:
     - Duel: 1v1 arena, flat terrain, pre-built melee characters
     - Skirmish: 2v2 with forest/cover, mixed melee + ranged
     - Siege: 1v3, defender has elevation + heavy armor, attackers
       have ranged + mobility feats
     - Mage Duel: 1v1, both characters are casters with full spell lists
     - Ambush: surprise round scenario, demonstrates Always Ready /
       Skirmishing Party / First Strike

5.2  Scenario builder improvements
     Tasks:
     - Terrain palette: click a terrain type, then paint it on the map
     - Unit palette: click a preset character, then place on map
     - Resize grid (5x5 to 20x20)
     - Name / description field for custom scenarios
     - Import/export scenarios as shareable JSON files
     - Elevation editing (set tile height for Strategic Archer, etc.)

5.3  Character templates / presets
     Tasks:
     - Pre-built character archetypes: Swordsman, Archer, Tank, Mage,
       Rogue, Brawler, Paladin
     - Each archetype has sensible stats, skills, equipment, and feats
     - Randomize button for quick character generation
     - Allow saving custom characters as reusable templates


================================================================================
  PHASE 6 - Testing and Quality                        (ONGOING)
================================================================================

6.1  Expand test coverage
     Tasks:
     - Add tests for every implemented feat (currently only a subset)
     - Add tests for spellcasting: successful cast, miscast, overcast
     - Add tests for edge cases: 0 HP + death save, block + riposte
       chain, dual striker vs shield bash, stacking debuffs
     - Add integration test: full combat from init to victory, verifying
       log output
     - Target: 80%+ code coverage on combat/ module

6.2  Rules validation suite
     Tasks:
     - Create a test file that encodes specific rule interactions from
       the Avalore docs and asserts the engine handles them correctly
     - Example: Heavy armor blocks ranged weapons -> test that a longbow
       cannot be equipped with heavy armor
     - Example: Graze with finesse blade still deals full damage -> test
       that bypass_graze works
     - Example: Large shield negates AP -> test AP immunity on block

6.3  Cleanup deprecated files
     Tasks:
     - Verify deprecated root-level ui_*.py files are removed
     - Remove duplicate csv import in pyside_app.py
     - Clean up dead code and unused imports


================================================================================
  PHASE 7 - Packaging and Distribution                 (LOW PRIORITY)
================================================================================

7.1  Cross-platform builds
     Tasks:
     - Update avasim.spec (PyInstaller) for Windows one-click build with
       icon and version metadata
     - Test macOS build via python3 pyside_app.py (already works)
     - Create a GitHub Actions workflow for CI: run tests on push,
       build artifacts for Windows + macOS on release tag
     - Add a make or just file for common dev tasks (test, build, run)

7.2  Version and updates
     Tasks:
     - Read version from packaging/version.txt at runtime; display in
       title bar and Help > About
     - Add Help > Check for Updates that opens the GitHub releases page
     - Add a CHANGELOG.md to track releases


================================================================================
  SUGGESTED EXECUTION ORDER FOR PHASE 4  (UI UPGRADE)
================================================================================

  The UI upgrade is large.  Tackle it in this order so each step
  produces a visible, shippable improvement:

  Sprint 1 â€” Foundations (do first, everything else builds on it):
    1. Layout Architecture (4.1) â€” sidebar + main canvas split
    2. Typography and Iconography (4.6) â€” bundle Inter/JetBrains Mono,
       upgrade icon set; this lifts the perceived quality of everything
    3. Theme System Upgrade (4.7) â€” purge hard-coded colors so all later
       work inherits correct theming automatically

  Sprint 2 â€” The Map (most visible single improvement):
    4. Map Visual Upgrade (4.3) â€” terrain patterns, unit tokens, grid
       labels, coordinate axis, fog dimming

  Sprint 3 â€” Combat Experience:
    5. Action Log & Combat Feed (4.4) â€” styled event cards, dice badges
    6. Replay & Timeline Bar (4.5) â€” visual pip timeline, speed selector

  Sprint 4 â€” Character & Polish:
    7. Character Cards Redesign (4.2) â€” stat badges, equipment tiles,
       feat chips, in-combat overlay cards
    8. Micro-interactions and Animations (4.8) â€” button hover, tab fade,
       toast slide, turn banner
    9. Responsive Layout (4.9) â€” splitter, fluid resize, test at
       multiple resolutions
